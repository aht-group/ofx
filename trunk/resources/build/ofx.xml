<?xml version="1.0" ?>
<project name="ofx"  basedir="../..">

	<property file="resources/properties/user.properties"/>
	<property file="resources/properties/ant.properties"/>

	<property name="src.dir" location="${basedir}/src" />
	<property name="dist.dir" location="${basedir}/dist/" />
	<property name="build.dir" location="${dist.dir}/build/" />
	<property name="lib.dir" location="${basedir}/lib" />
	<property name="rsrc.dir" location="${basedir}/resources" />
	<property name="xsd.dir" location="${basedir}/resources/xsd" />
	
	<import file="ant-libs.xml"/>
	<import file="ant-classpath.xml"/>
	<import file="ant-tasks.xml"/>
	
	<!-- target init -->	
    <target name="2 - init" description="Init ...">
    	<mkdir dir="${dist.dir}"/>
		<mkdir dir="${build.dir}"/>
	</target>
	
    <target name="2 - Clean" description="Removes build artifacts">
    	<delete dir="${dist.dir}"/>
    </target>
	
	<target name="3 - compile" depends="2 - init" description="Compile the source">
		<javac	srcdir="${src.dir}"
				destdir="${build.dir}"
				debug="true"
				debuglevel="lines,vars,source" 
				deprecation="on"
				optimize="on"
				encoding="UTF-8"
				classpathref="classpath">
			<include name="org/openfuxml/**"/>
		</javac>
	</target>
	
	<target name="4 - JAXB Class generation" depends="1 - Tasks" description="Compile the source">
		<echo level="info">Creating JAXB Configuration Class</echo>
		<xjc schema="${xsd.dir}/ofx-wiki.xsd" package="org.openfuxml.addon.wiki.data.jaxb" destdir="${src.dir}">
			<arg value="-extension" />
			<depends dir="${xsd.dir}"><include name="ofx-wiki.xsd"/></depends>
			<produces dir="${src.dir}/org/openfuxml/addon/wiki/data/jaxb"><include name="*.java"/></produces>
		</xjc>
	    <java classname="com.sun.tools.xjc.XJCFacade"
	          fork="true" failonerror="true"  maxmemory="128m">
	         <arg value="-extension"/>
	    	 <arg value="${xsd.dir}/jsf-taglib.xsd"/>
	    	 <arg value="-d"/><arg value="${src.dir}"/>
	    	 <arg value="-p"/><arg value="org.openfuxml.addon.jsf.data.jaxb"/>
	         <classpath>
	         	<pathelement location="${lib.dir}/${jaxb.dir}/${jaxbimpl.lib}"/>
	         	<pathelement location="${lib.dir}/${jaxb.dir}/${jaxbxjc.lib}"/>
	         </classpath>
	      </java>
		
<!--	<xjc schema="${xsd.dir}/jsf-taglib.xsd" package="org.openfuxml.addon.jsf.data.jaxb" destdir="${src.dir}">
			<arg value="-extension" />
			<depends dir="${xsd.dir}"><include name="jsf-taglib.xsd"/></depends>
			<produces dir="${src.dir}/org/openfuxml/addon/jsf/data/jaxb"><include name="*.java"/></produces>
		</xjc>
		<xjc schema="${xsd.dir}/ofx.xsd" package="org.openfuxml.content" destdir="${src.dir}">
			<arg value="-extension" />
			<jvmarg value="-Djava.endorsed.dirs=${lib.dir}/${jaxb.dir}" />
			<depends dir="${xsd.dir}"><include name="ofx.xsd"/></depends>
			<produces dir="${src.dir}/org/openfuxml/content"><include name="*.java"/></produces>
		</xjc>
-->	</target>
	
	<target name="5 - OFX Release" depends="3 - compile">
		<echo>Create ofx lib: openFuXML-${openfuxml-version}.jar</echo>
        <jar destfile="${dist.dir}/openFuXML-${openfuxml-version}.jar">
            <fileset dir="${build.dir}/"/>
			<manifest>
				<attribute name="Built-By" value="${user.name}"/>
			</manifest>        	
        </jar>
	</target> 
	
</project>